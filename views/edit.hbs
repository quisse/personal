{{#section 'head'}}
    <link rel="stylesheet" type="text/css" href="/stylesheets/content-tools.min.css">
{{/section}}
<a href="/admin">back</a>
    <div data-editable data-name="content">
        {{#unless content }}
        <p>this is the intro paragraph</p>
        {{/unless}}
        {{{content}}}
    </div>
<a href="/admin">back</a>
{{#section 'foot'}}
    <script src="/javascripts/content-tools.min.js"></script>
    <script>
        window.addEventListener('load', function(){
            var editor;
            editor = ContentTools.EditorApp.get();
            editor.init('*[data-editable]', 'data-name');
            editor.bind('save', function (regions) {
                var name, payload, xhr;

                // Set the editor as busy while we save our changes
                this.busy(true);

                // Collect the contents of each region into a FormData instance
                payload = new FormData();
                for (name in regions) {
                    if (regions.hasOwnProperty(name)) {
                        payload.append(name, regions[name]);
                    }
                }
                console.log(payload);

                // Send the update content to the server to be saved
                function onStateChange(ev) {
                    // Check if the request is finished
                    if (ev.target.readyState == 4) {
                        editor.busy(false);
                        if (ev.target.status == '200') {
                            // Save was successful, notify the user with a flash
                            new ContentTools.FlashUI('ok');
                        } else {
                            // Save failed, notify the user with a flash
                            new ContentTools.FlashUI('no');
                        }
                    }
                };
                xhr = new XMLHttpRequest();
                xhr.addEventListener('readystatechange', onStateChange);
                xhr.open('POST',window.location.pathname);
                xhr.send(payload);
            });
        })
    </script>
{{/section}}